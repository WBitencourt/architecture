import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  stages: [
    { duration: '30s', target: 20 }, // Sobe para 20 usuários
    { duration: '1m', target: 20 },  // Mantém 20 usuários
    { duration: '20s', target: 0 },  // Desce para 0
  ],
};

export default function () {
  const BASE_URL = 'http://seu-servidor:3000';

  // 1. Simula leitura (Leve)
  let res1 = http.get(`${BASE_URL}/products`);
  check(res1, { 'status is 200': (r) => r.status === 200 });

  sleep(1); // Simula o usuário "pensando"

  // 2. Simula uma busca pesada com filtros (Médio/Banco de Dados)
  let res2 = http.get(`${BASE_URL}/orders?search=test&limit=50`);
  check(res2, { 'db query success': (r) => r.status === 200 });

  sleep(1);

  // 3. Simula um Login (Pesado/CPU - Bcrypt)
  const payload = JSON.stringify({ email: 'user@test.com', password: '123' });
  const params = { headers: { 'Content-Type': 'application/json' } };
  let res3 = http.post(`${BASE_URL}/auth/login`, payload, params);
  check(res3, { 'login success': (r) => r.status === 201 });
}